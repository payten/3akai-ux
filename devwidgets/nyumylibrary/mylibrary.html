<!-- CSS -->
<link rel="stylesheet" type="text/css" href="/devwidgets/nyumylibrary/css/mylibrary.css" />

<div style="display:none">__MSG__IE_PLACEHOLDER__</div>

<div id="widget_deletecontent" class="widget_inline"></div>

<div class="mylibrary_widget">
    <div class="tagcloud-container" style="display: none;">
        <div class="s3d-contentpage-title">
            Tag Cloud
            <div class="s3d-button s3d-header-button s3d-header-smaller-button s3d-listview-options">
                <div class="s3d-listview-cloud selected">
                    <div class="s3d-action-icon s3d-search-results-cloudview selected"></div>
                </div>
                <div class="s3d-listview-list">
                    <div class="s3d-action-icon s3d-search-results-listview"></div>
                </div>
            </div>
        </div>        
        <div class="tagcloud-row"></div>
    </div>    
    <div id="mylibrary_title_container"></div>
    <div id="mylibrary_title_template"><!--
        {if isMe && !isGroup}
            <div class='s3d-contentpage-title'>__MSG__MY_LIBRARY__</div>
        {else}
            <div class='s3d-contentpage-title'>__MSG__MY_LIBRARY_OTHER__</div>
        {/if}
    --></div>

    <div class="s3d-page-header-top-row" style="display:none;">
        <div class="s3d-button s3d-header-button s3d-header-smaller-button s3d-listview-options">
            <div class="s3d-listview-grid">
                <div class="s3d-action-icon s3d-search-results-gridview"></div>
            </div>
            <div class="s3d-listview-list selected">
                <div class="s3d-action-icon s3d-search-results-listview selected"></div>
            </div>
        </div>
        <div id="mylibrary_sortarea" class="s3d-margin-top-5 s3d-page-header-sort-area" style="display:none;">
            <label for="mylibrary_sortby">__MSG__SORT_BY__:</label>
            <select id="mylibrary_sortby" name="mylibrary_sortby">
                <option value="modified">__MSG__RECENTLY_CHANGED__</option>
                <option value="asc"> __MSG__A_Z__</option>
                <option value="desc">__MSG__Z_A__</option>
            </select>
        </div>
        <div class="s3d-search-container">
            <input id="mylibrary_livefilter" type="text" title="__MSG__SEARCH_THROUGH_THE_CONTENT_LIBRARY__" class="s3d-search-inputfield"/>
            <button type="button" id="mylibrary_search_button" class="s3d-button s3d-overlay-button s3d-search-button">
                <img src="/dev/images/search_icon.png" alt="__MSG__SEARCH_THROUGH_THE_CONTENT_LIBRARY__"/>
            </button>
            <div id="search_tags_active_container" class="s3d-search-activetags"></div>
        </div>
	<div class="refine-by-tags-row s3d-search-refineby">
		<div class="search_tags_refine_container"></div>
	</div>        
    </div>
    <div class="s3d-page-header-bottom-row" style="display:none;">
        <button type="button" class="s3d-button s3d-large-button fl-force-right sakai_add_content_overlay mylibrary_add_content_button" style="display:none;">
            __MSG__ADD_CONTENT__
        </button>

        <div id="mylibrary_select" class="s3d-button s3d-header-button s3d-header-smaller-button fl-force-left" title="__MSG__SELECT_ALL_LIBRARY_ITEMS__">
            <input type="checkbox" id="mylibrary_select_checkbox"/>
        </div>

        <button type="button" id="mylibrary_addpeople_button" class="s3d-button s3d-header-button s3d-header-smaller-button savecontent_trigger fl-force-left" disabled="true" data-entitycontext="mylibrary" data-entityname="" data-entityid="">
            <span class="s3d-page-header-add-to-icon"></span>
            __MSG__ADD_TO__...
        </button>

        <button type="button" id="mylibrary_content_share" data-entityid="" class="s3d-button s3d-header-button s3d-header-smaller-button share_trigger_click fl-force-left" disabled="true">
            <span class="entity_share_content"></span>
            __MSG__SHARE__
        </button>

        <button type="button" id="mylibrary_remove" class="s3d-button s3d-header-button s3d-header-smaller-button" style="display:none;" disabled="disabled">
            __MSG__REMOVE_SELECTED__
        </button>
        <hr class="fl-push fl-hidden"/>
    </div>

    <div id="mylibrary_empty" class="fl-container fl-fix" style="display:none;"><!----></div>
    <div id="mylibrary_empty_template"><!--
        {if query}
            <div class="s3d-no-results-container">
                <div class="s3d-no-results-arrow-up"></div>
                <div class="s3d-no-results-icon s3d-no-results-search-content less-margin"></div>
                <h1>__MSG__NO_SEARCH_RESULTS__ <a class="s3d-regular-links" href="/search#l=content">__MSG__CONTENT_LC__</a>.</h1>
            </div>
        {else}
            {if mode === "user_me"}
                <div class="s3d-no-results-container">
                    <div class="s3d-no-results-arrow-up"></div>
                    <div class="s3d-no-results-icon s3d-no-results-content less-margin"></div>
                    <h1>__MSG__NO_RESULTS_DESCRIPTION_ME__ <button id="mylibrary_addcontent" class="s3d-link-button sakai_add_content_overlay">__MSG__ADD_CONTENT__</button></h1>
                </div>
            {elseif mode === "user_other"}
                <div class="s3d-no-results-container">
                    <div class="s3d-no-results-arrow-up"></div>
                    <div class="s3d-no-results-icon s3d-no-results-content less-margin"></div>
                    <h1>__MSG__NO_RESULTS_DESCRIPTION_NOT_ME__</h1>
                </div>
            {elseif mode === "group_managed"}
                <div class="s3d-no-results-container">
                    <div class="s3d-no-results-arrow-up"></div>
                    <div class="s3d-no-results-icon s3d-no-results-content less-margin"></div>
                    <h1>__MSG__NO_RESULTS_DESCRIPTION_GROUP__. <button id="mylibrary_addcontent" class="s3d-link-button sakai_add_content_overlay">__MSG__ADD_CONTENT__</button></h1>
                </div>
            {elseif mode === "group"}
                <div class="s3d-no-results-container">
                    <div class="s3d-no-results-arrow-up"></div>
                    <div class="s3d-no-results-icon s3d-no-results-content less-margin"></div>
                    <h1>__MSG__NO_RESULTS_DESCRIPTION_GROUP__</h1>
                </div>
            {/if}
        {/if}
    --></div>

    <!-- Library Items -->
    <ul id="mylibrary_items" style="display:none;"><!-- TEMPLATE HERE --></ul>
    <div id="mylibrary_items_template"><!--
    {if items}
        {var count = 0}
        {for item in items}
            {if item["sakai:pooled-content-file-name"]}
                {var count = count + 1}
                <li id="${item.id|safeOutput}" class="fl-container fl-fix mylibrary_item s3d-search-result s3d-draggable-container" data-scope="content" data-entityid="${item.id}" {if sakai.api.Content.Collections.isCollection(item)} data-collection="true" {/if}>
                    <div class="s3d-search-result-user-functions s3d-draggable-hidden">
                        <div class="mylibrary_item_left_filler">
                            {if !sakai.data.me.user.anon}
                                <input class="mylibrary_check s3d-draggable-select" id="mylibrary_check_${item.id}" type="checkbox" data-entityid="${item.id}" data-entityname="${item.filename|safeOutput}"/>
                                {if isMe}
                                    <label for="mylibrary_check_${item.id}" class="s3d-aural-text">__MSG__SELECT__ ${item.filename|safeOutput} __MSG__SELECT_REMOVE__</label>
                                    <button class="s3d-link-button s3d-action-icon s3d-actions-delete mylibrary_remove_icon" type="button" title="__MSG__REMOVE__" data-entityid="${item.id}"></button>
                                {/if}
                            {/if}
                        </div>
                        <button title="__MSG__SAVE_CONTENT__" data-entityid="${item.id}" class="s3d-link-button s3d-action-icon s3d-actions-addtolibrary mylibrary_item_share_icon savecontent_trigger s3d-draggable-hidden"></button>
                        <button class="s3d-link-button s3d-action-icon s3d-actions-share mylibrary_item_share_icon share_trigger_click s3d-draggable-hidden" data-entityid="${item.id}" title="__MSG__SHARE_CONTENT__"></button>
                    </div>
                    <a href="${item.link}/${item["sakai:pooled-content-file-name"]|safeURL}" title="__MSG__VIEW_THIS_ITEM__">
                        {if item.thumbnail}
                            <img class="s3d-icon-40" src="${item.thumbnail}" alt="${item.mimeTypeDescription}" />
                        {else}
                            <img alt="${item.mimeTypeDescription}" src="${item.mimeTypeURL}" />
                        {/if}
                    </a>
                    <div class="mylibrary_item_right s3d-regular-links s3d-search-result-right">
                        <div>
                            <a class="s3d-bold s3d-regular-light-links" href="${item.link}/${item["sakai:pooled-content-file-name"]|safeURL}" title="__MSG__VIEW_THIS_ITEM__">
                                <span class="s3d-search-result-name">${item['sakai:pooled-content-file-name-short']|safeOutput}</span>
                                <span class="s3d-search-result-name-grid">${item['sakai:pooled-content-file-name-shorter']|safeOutput}</span>
                            </a>
                            {if item.mimeTypeDescription}
                                <span class="mylibrary_item_mimetype">${item.mimeTypeDescription|safeOutput}</span>
                            {/if}
                        </div>
                        <div class="mylibrary_item_by">
                            {if item.ownerDisplayName}
                                __MSG__BY__ <a class="s3d-regular-light-links{if sakai.data.me.user.userid !== item.ownerId} mylibrary_item_username{/if}" href="/~${item.ownerId|safeURL}">${item.ownerDisplayName}</a> 
                                <span class="s3d-search-result-detail-separator">
                                    <span> | </span>
                                </span>
                            {/if}
                            __MSG__CHANGED__ ${jQuery.timeago(new Date(item._lastModified))}
                        </div>
                        {if item["sakai:description-long"]}
                            <div class="mylibrary_item_description">
                                ${item["sakai:description-long"]}
                            </div>{/if}
                        {if item.tags && item.tags.length > 0}
                            <div class="mylibrary_item_tags s3d-taglist">
                                <ul class="mylibrary_item_tags_list">
                                    {for t in item.tags}
                                        <li><a class="s3d-regular-light-links" href="${t.link}" title="${t.linkTitle}">${t.value}</a></li>
                                    {/for}
                                </ul>
                            </div>
                        {/if}
                        {if !$.isEmptyObject(item.tagsProcessed)}
                            <div class="mylibrary_item_tags">
                                <ul class="mylibrary_item_tags_list s3d-taglist">
                                    {for t in item.tagsProcessed}
                                        <li>
                                            <a class="s3d-regular-light-links" href="${t.link}" title="${t.linkTitle}">
                                                <span class="s3d-search-result-tag">${t.tagShort}</span>
                                                <span class="s3d-search-result-tag-grid">${t.tagShorter}</span>
                                            </a>
                                        </li>
                                    {/for}
                                </ul>
                            </div>
                        {/if}
                        <div class="mylibrary_item_usedin">
                            {var placeCount = sakai.api.Content.getPlaceCount(item)}
                            {if item.numPlaces > 0}
                                <span class="mylibrary_item_icon mylibrary_item_usedin_icon"></span>
                                __MSG__USED_IN__ ${item.numPlaces} {if item.numPlaces === 1} __MSG__PLACE__{else} __MSG__PLACES__{/if}
                            {/if}
                            {if item.numComments > 0}
                                <span class="mylibrary_item_icon mylibrary_item_comments_icon"></span>
                                ${item.numComments} {if item.numComments === 1} __MSG__COMMENT__{else} __MSG__COMMENTS__{/if}
                            {/if}
                        </div>
                    </div>
                </li>
            {/if}
        {/for}
    {/if}
    --></div>
    
    <!-- TEMPLATE FOR ACTIVE REFINE BY TAGS -->
    <div id="search_tags_active_template"><!--
        {for t in tags}
            <span class="s3d-search-tag">
                <img src=/dev/images/search_tag_active.png" />
                <button class="search_tag_active_item" data-sakai-entityid="${t.original}" title="__MSG__REMOVE__ ${t.value} __MSG__FROM_SEARCH__">
                    ${sakai.api.Util.applyThreeDots(t.value, 345, null, null, true)}<img src=/dev/images/search_tag_remove.png" />
                </button>
            </span>
        {/for}
    --></div>

    <!-- TEMPLATE FOR REFINE BY TAGS LIST -->
    <div id="search_tags_refine_template"><!--
        {var tagsListed = false}
        {for t in tags}
            {if t_index === "0"}
                <span class="s3d-search-refineby-title">__MSG__REFINE_YOUR_SEARCH_BY__</span>
                <div class="s3d-search-refineby-list">
                {var tagsListed = true}
            {/if}
            <span class="s3d-search-tag">
                <button class="search_tag_refine_item" data-sakai-entityid="${t.original}" title="__MSG__REFINE_SEARCH_TO__ ${t.value}">
                    <img src=/dev/images/search_tag_add.png" />
                    ${sakai.api.Util.applyThreeDots(t.value, 345, null, null, true)}
                </button>
            </span>
        {/for}
        {if tagsListed === true}
            </div>
        {/if}
    --></div>
    
    <div id="mylibrary_tagcloud_list_template"><!--
        {if tags.length}
            <ul class="tagcloud-list">
            {for tag in tags}
                {if activetags.indexOf(tag.value) < 0}
                    <li class="s3d-search-tag s3d-search-refineby" data-sakai-entityid="${tag.original}">                    
                        <button class="search_tag_refine_item search_tag_active_item" data-sakai-entityid="${tag.original}" title="__MSG__REFINE_SEARCH_TO__ ${tag.value}">
                            <img src="/dev/images/search_tag_add.png">
                            ${tag.value}
                        </button>
                    </li>                                               
                {else}
                    <li class="s3d-search-tag s3d-search-activetags" data-sakai-entityid="${tag.original}">
                        <img src="/dev/images/search_tag_active.png">
                        <button class="search_tag_refine_item search_tag_active_item" data-sakai-entityid="${tag.original}" title="__MSG__REFINE_SEARCH_TO__ ${tag.value}">                            
                            ${tag.value}
                            <img src="/dev/images/search_tag_remove.png">
                        </button>
                    </li>
                {/if}
            {forelse}
            <li>__MSG__NO_TAGS_FOUND__</li>
            {/for}
            </ul>
        {else}
            <p>__MSG__NO_TAGS_FOUND__</p>
        {/if}
    --></div>
    
    <div id="mylibrary_notalltagsdisplayed_message" style="display:none"><span class="not-all-tags-msg">__MSG__NOT_ALL_TAGS_DISPLAYED__</span></div>
</div>

<!-- JAVASCRIPT -->
<script type="text/javascript" src="/devwidgets/nyumylibrary/javascript/mylibrary.js"></script>
