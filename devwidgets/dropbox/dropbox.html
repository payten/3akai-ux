<!-- CSS -->
<link rel="stylesheet" type="text/css" media="screen" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.8/themes/flick/jquery-ui.css" />
<link rel="stylesheet" type="text/css" href="/devwidgets/dropbox/lib/jquery.ui.datetime.css" />
<link rel="stylesheet" type="text/css" href="/devwidgets/dropbox/lib/jquery.ui.datepicker.css" />
<link rel="stylesheet" type="text/css" href="/devwidgets/dropbox/css/dropbox.css" />

<div class="dropbox_widget">

    <!-- CONTENT -->
    <div class="fl-widget-content s3d-widget-content">

        <!-- MAIN VIEW -->
        <div id="dropbox_display" style="display:none">
            <div id="dropbox_submission_details"></div>
            <div id="dropbox_submission_form"></div>
            <div id="dropbox_submissions"></div>
            <div id="dropbox_review"></div>
                        
        </div>

        <!-- SETTINGS VIEW -->
        <div id="dropbox_settings" style="display:none">
            <form id="dropbox_settings_form" method="post">                                                
                                                
            </form>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="s3d-widget-no-options">
        <div class="s3d-widget-no-options-inner"></div>
    </div>
    
    <!-- TEMPLATES -->
    <div id="dropbox_submission_details_template"><!--
        <div class="dropbox_title">${title}</div>
        <div class="dropbox_deadline"><b>Deadline</b>: ${deadline}</div>
        <div class="dropbox_countdown"><b>Countdown</b>: ${diff}</div>                                       
        <div class="dropbox_window"><b>Open</b>: ${active_from}<br/><b>Closes</b>: ${active_to}</div>                                          
    --></div>    
    <div id="dropbox_submission_form_template"><!--
        <div class="dropbox_title">Upload a File:</div>
        <form id="dropbox_upload_form" class="newaddcontent_form" method="POST" enctype="multipart/form-data">
             <input name="fileData" id="multifile_upload" type="file" class="multi" size="42"/>
             <input id="dropbox_upload_form_btnSubmit" type="button" value="Upload"/>
        </form><br/>         
        <p>OR</p>                                             
        <div class="dropbox_title">Select from your Library:</div>  
        <div id="dropbox_search_form" class="newaddcontent_form">
             <input name="searchText" id="searchText" type="text"  size="42" autocomplete="off" />                          
        </div>                                                   
    --></div>
    <div id="dropbox_search_selected_item_template"><!--         
        <form id="dropbox_my_content_form" class="newaddcontent_form" method="POST" style="display:none;">
            <div class="dropbox_title">                                                                                            
                ${name}
            </div>
             <input name="path" id="path" type="hidden" value="${id}"/>
             <input name="filename" id="filename" type="hidden" value="${name}"/>                                                    
             <input id="dropbox_upload_from_library_btnSubmit" type="button" value="Upload"/>
        </form>                                                   
    --></div>    
    <div id="dropbox_search_results_template"><!--
        <div id="dropbox_search_results">
            {if count === 0}
                No matches in your Library
            {else}
                <ul>                              
                {for f in files}
                    <li class="dropbox_search_result">
                        <div class="dropbox_content_icon_container fl-force-left">
                            <span class="dropbox_content_icon ${f.css_class}"></span>
                        </div>                        
                        <a class="dropbox_search_result_link" rel="${f.id}" title="${f.name}">${f.dottedname}</a>                                              
                    </li>                                                                
                {/for}
                </ul>                                              
            {/if}                                              
        </div>        
    --></div>    

    <div id="dropbox_submission_template"><!--
        <div class="dropbox_title">Your Submissions</div>
        <table class="dropbox_table">
            <tr>
                <th width="50%">Filename</th>
                <th width="10%">Version</th>                          
                <th>Created</th>
                <th>Last Modified</th>
                <th>&nbsp;</th>                          
            </tr>
            <tbody>              
                  <tr>                                         
                   <td>${filename}</td>
                   <td>TODO</td>                       
                   <td>${_created}</td>
                   <td>${_lastModified}</td>
                    <td><a href="/content#p=${poolId}/${filename}" target="_blank">View</a> <a href="/p/${poolId}/${filename}" target="_blank">Download</a></td>                                          
                  </tr>                               
            </tbody>
        </table>                                              
    --></div>
    
    <div id="dropbox_review_template"><!--
        <div class="dropbox_title">All Submissions</div>
        <table class="dropbox_table">
            <tr>
                <th width="10%">Userid</th>
                <th width="50%">Filename</th>
                <th>Created</th>
                <th>Last Modified</th>
                <th>&nbsp;</th>                      
            </tr>
            <tbody>
                {var i=0}                      
                {for s in submissions}                                      
                  {if s_index[0] != "_"}                    
                      <tr class="{if i%2}even{else}odd{/if}">                                         
                       <td><a href="/~${s_index}">${s_index}</a></td>                   
                       <td>${s.filename}</td>
                       <td>${s._created}</td>
                       <td>${s._lastModified}</td>
                       <td><a href="/content#p=${s.poolId}/${s.filename}" target="_blank">View</a> <a href="/p/${s.poolId}/${s.filename}" target="_blank">Download</a></td>                                                       
                      </tr>          
                      {var i = i+1}                 
                  {/if}                  
                {/for}                     
            </tbody>
        </table>                                              
    --></div>    
    
    <div id="dropbox_settings_form_template"><!--
        <p><b>Step 1 - set the dropbox title (also a prefix for all submitted files):</b><br/>
            Title: <input id="title" name="title" type="text" value="${title}"  />
        </p>                
        <p><b>Step 2 - Define the window when the dropbox is active:</b><br/>            
            From:&nbsp;<input id="active_from" name="active_from" value="${active_from.strftime("%Y-%m-%d %H:%M")}" readonly="readonly" />&nbsp;To:&nbsp;<input id="active_to" name="active_to" value="${active_to.strftime("%Y-%m-%d %H:%M")}" readonly="readonly" />
        </p>                                         
        <p><b>Step 3 - Set the submission deadline:</b><br/>
            Deadline: <input id="deadline" name="deadline" type="text" value="${deadline.strftime("%Y-%m-%d %H:%M")}" readonly="readonly" />
        </p>
        <p>
            <span style="color: #888;">Timezone:</span> <span>${timezone} (${timezoneOffset})</span>            
        </p>                                             
                                             
        <div class="dialog_buttons">                    
            <button class="s3d-button s3d-button-primary" id="dropbox_btnInsertWidget"><span class="s3d-button-inner">Save</span></button>                    
        </div>                                         
    --></div>       
    
</div>

<!-- JAVASCRIPT -->
<script type="text/javascript" src="/devwidgets/dropbox/javascript/dropbox.js"></script>
